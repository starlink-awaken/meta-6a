# Medium Check - 中等分析工作流

> meta-6a skill 的中等深度工作流
>
> 用途：介于快速验证和完整分析之间的中等深度分析
>
> 框架：5A 核心 + 扩展模块

## 触发条件

当用户使用以下关键词时触发：
- "6A检查" "medium-check" "中等分析"
- 或者请求对需求/设计进行中等深度分析时

## 分析过程

AI 应该进行以下分析（部分内部思考，部分输出）：

1. **AIAnalyze** - 完整扫描：
   - 核心问题是什么？
   - 问题边界在哪里？
   - 信息完整度评估
   - 关键依赖识别

2. **AIArchitect** - 架构评估：
   - 可行性分析
   - 技术风险识别
   - 复杂度评估
   - 替代方案考虑

3. **扩展模块判断**：
   - 是否为 AI Agent 项目？→ 考虑 AIAgent 扩展

4. **其他阶段** - 选择性深入：
   - 根据问题类型，选择 2-3 个最相关的 5A 阶段
   - 每个选定阶段进行中等深度分析

## 输出格式

```
5A中等分析

[问题分析]（100-150词）
- 核心问题：[一句话明确问题]
- 问题边界：[定义问题的范围和限制]
- 完整性评估：[完整度评分（高/中/低）及缺失项说明]
- 关键依赖：[识别的主要依赖关系]

[关键阶段分析]（选择 2-3 个最相关的 5A 阶段，或 5A+扩展）

阶段 1：[阶段名称]
- 分析要点：[2-3 个关键点]
- 发现：[具体发现或评估]
- 建议：[针对性建议]

阶段 2：[阶段名称]
- 分析要点：[2-3 个关键点]
- 发现：[具体发现或评估]
- 建议：[针对性建议]

[综合建议]（100-150词）
1. [最重要且可执行的建议，带简要理由]
2. [次重要建议，带简要理由]
3. [第三建议，带简要理由]

[风险提示]（如果有）
- [风险1]：[影响评估]
- [风险2]：[影响评估]
```

## 质量门控

在输出前，AI 应该自检：

- [ ] 问题分析是否包含核心问题、边界、完整性三个维度？
- [ ] 是否选择了 2-3 个最相关的 5A 阶段？
- [ ] 扩展模块判断是否有明确结论？
- [ ] 每个阶段的分析是否有具体发现？
- [ ] 建议是否附带理由？
- [ ] 输出是否在 300-500 词范围内？

## 示例

### 示例 1：需求中等分析

**用户输入**：
```
6A检查这个需求："开发一个用户登录功能，支持邮箱和手机号登录，包含验证码和密码找回"
```

**AI 输出**：
```
5A中等分析

问题分析
- 核心问题：用户认证系统的实现需求，包含登录方式和账号恢复功能
- 问题边界：聚焦于登录和找回密码，不涉及注册流程和用户管理
- 完整性评估：中等 - 缺少安全要求、会话管理、第三方集成需求
- 关键依赖：短信/邮件服务、数据库设计、现有用户系统集成

阶段 1：AIAnalyze
- 分析要点：需求结构清晰、功能点明确、安全性考虑不足
- 发现：登录方式定义明确，但缺少加密要求、会话超时、并发登录限制
- 建议：补充密码复杂度要求、会令牌过期策略、登录失败处理规则

阶段 2：AIArchitect
- 分析要点：认证服务架构、API 设计、数据存储
- 发现：需要独立的认证服务、验证码有效期管理、密码重置安全流程
- 建议：采用标准 OAuth 2.0 或 JWT 架构，验证码使用 Redis 缓存

综合建议
1. 优先明确安全规范：密码使用 bcrypt/Argon2 加密，JWT 有效期设置，验证码 5 分钟过期
2. 设计 API 前先确认是否需要支持第三方登录（微信、Google 等），影响架构选择
3. 密码找回流程需要多重验证：验证码 + 身份验证问题，防止账号劫持

风险提示
- 短信/邮件服务依赖：第三方服务不稳定影响用户体验，建议准备多个服务商备选
- 密码重置安全：重置链接需要一次性使用和短时效，防止重放攻击
```

### 示例 2：设计中等分析

**用户输入**：
```
中等分析这个设计："电商订单系统，使用微服务架构，包含订单服务、支付服务、库存服务"
```

**AI 输出**：
```
5A中等分析

问题分析
- 核心问题：电商订单系统的微服务架构设计
- 问题边界：三个核心服务，暂不涉及用户、商品、物流等周边系统
- 完整性评估：中等 - 缺少服务间通信协议、数据一致性方案、监控体系
- 关键依赖：消息队列、分布式事务、服务注册中心

阶段 1：AIArchitect
- 分析要点：服务拆分合理性、通信方式、数据一致性
- 发现：服务拆分符合领域边界，但需要明确同步/异步通信场景
- 建议：订单-支付使用同步（需要实时结果），订单-库存使用异步（消息队列）

阶段 2：AIBuild
- 分析要点：接口设计、幂等性、错误处理
- 发现：支付和库存操作需要强幂等性保证，避免重复扣款/扣库存
- 建议：使用唯一请求 ID，所有写操作带幂等键

阶段 3：AIApply
- 分析要点：服务监控、熔断降级、扩展性
- 发现：缺少监控和容错设计，生产环境风险较高
- 建议：接入 Prometheus + Grafana，配置服务间熔断器

综合建议
1. 数据一致性方案：采用 Saga 模式处理跨服务事务，支付失败自动回滚库存预占
2. 接口设计遵循 RESTful 或 gRPC，统一返回格式，包含错误码和错误描述
3. 部署前完成压力测试，重点验证支付峰值场景下的服务稳定性

风险提示
- 分布式事务：Saga 模式增加了业务复杂度，需要为每个服务设计补偿逻辑
- 服务雪崩：库存服务故障会影响下单，需要限流和降级策略
```

## 特殊处理

### 如果问题很简单

如果用户的请求很简单，不需要中等深度分析，AI 应该：

```
建议使用快速验证模式。
当前问题较为简单，中等分析可能过度。
[简要说明为什么简单]
```

### 如果问题很复杂

如果用户的问题很复杂，建议升级到完整分析：

```
当前问题较为复杂，中等分析可能无法充分覆盖。
建议使用"完整6A"或"deep-analysis"进行深度分析。
[列出需要深入的关键点]
```

## 输出原则

1. **深度适中**：默认输出 300-500 词，比快速验证详细，比完整分析简洁
2. **聚焦关键**：选择 2-3 个最相关的 5A 阶段深入，不追求面面俱到
3. **扩展感知**：识别项目类型，判断是否需要加载扩展模块
4. **具体建议**：每条建议都应附带理由，增强说服力
5. **风险意识**：主动识别和提示潜在风险

## 时间限制

- 分析时间：< 20秒
- 输出时间：< 10秒
- 总计：< 30秒
